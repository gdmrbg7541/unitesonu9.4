<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>أَكْمِل الجُمْلة - 4 Seviye</title>
    
    <script src="https://cdn.jsdelivr.net/npm/drag-drop-touch@1.3.1/DragDropTouch.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;600&display=swap');
        
        :root {
            --scale: 1; 
        }

        body{font-family:'Markazi Text',serif;font-weight:400;background-color:#000;color:#333;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:0;overflow:hidden}
        #game-container{width:1920px;height:1080px;background-color:#f4f7f6;position:absolute;top:50%;left:50%;transform-origin:center center;padding:30px;box-sizing:border-box;display:flex;flex-direction:column;backface-visibility:hidden;-webkit-backface-visibility:hidden;will-change:transform}
        
        /* Başlık ve Tur Göstergesi */
        header { text-align: center; margin-bottom: 20px; position: relative; }
        h1{color:#00796b;margin:0;font-size:4.4rem;white-space:nowrap;line-height: 1;}
        #level-indicator { font-size: 2.0rem; color: #555; margin-top: 10px; font-weight: bold; }

        .etkilesim-alani{display:flex;flex-wrap:nowrap;gap:40px;flex:1;min-height:0;overflow:hidden}
        .cumleler-kutusu{flex:1.5;min-width:0;padding-right:40px;display:flex;flex-direction:column;justify-content:space-around;overflow-x:hidden}
        .secenekler-kutusu{flex:1;min-width:400px;background-color:#fafafa;border:2px dashed #d0d0d0;border-radius:16px;padding:20px;padding-left:40px;display:flex;flex-direction:column;align-items:center;justify-content:space-around;transition:background-color .3s ease;overflow-x:hidden}
        
        .cumle-satiri{display:flex;align-items:center;margin-bottom:12px;background-color:#eee;border-radius:16px;padding:8px 20px;min-height:80px;transition:transform .3s ease,opacity .3s ease}
        .cumle-baslangic{font-size:3.2rem;line-height:1.25;padding:4px 0;color:#222;text-align:right;margin-left:10px;flex-grow:1;min-width:0;transition:color .3s ease}
        
        .cumle-baslangic.metin-pasif{color:#9e9e9e}
        
        .kart-bitis{font-size:3.0rem;font-weight:600;line-height:1.15;padding:6px 20px;background-color:#fff;border:1px solid #ccc;border-radius:16px;margin-bottom:4px;cursor:grab;transition:opacity .2s,box-shadow .2s,transform .2s cubic-bezier(0.2, 0, 0.3, 1),background-color .3s,border-color .3s;user-select:none;-webkit-user-select:none;-webkit-touch-callout:none;width:fit-content;max-width:95%;white-space:nowrap;}
        .kart-bitis:hover:not(.siluet){box-shadow:0 8px 16px rgba(0,0,0,.15);transform:translateY(-3px) scale(1.03)}
        .kart-bitis.dragging{opacity:.75;box-shadow:0 20px 40px rgba(0,0,0,.3);transform:translateY(-10px) scale(1.02)}
        
        .kart-bitis.siluet{
            background-color:#f0f0f0;
            border-color:#d0d0d0;
            color:#bbb;
            cursor:not-allowed;
            opacity:.3;
            pointer-events:none;
            transform:none!important;
            box-shadow:none!important
        }
        
        .drag-ghost{
            opacity:.7;
            background:white;
            border:1px solid #ccc;
            border-radius:16px;
            box-shadow:0 10px 20px rgba(0,0,0,.2);
            font-family:'Markazi Text',serif; 
            font-size:3.0rem;
            font-weight:600;
            line-height:1.15;
            padding:6px 20px;
            pointer-events:none;
            position:absolute;
            top:-9999px; 
            left:-9999px;
            z-index:999;
            transform: none !important;
            will-change: auto !important;
        }

        .birakma-alani{width:400px;flex-shrink:0;min-height:72px;border-radius:16px;transition:background-color .3s ease,box-shadow .3s ease,border-color .3s ease;display:flex;align-items:center;justify-content:center;position:relative;background-color:transparent;padding:4px 10px;box-sizing:border-box;margin-right:10px;border:2px dashed #bbb}
        @keyframes pulseBg{0%{background-color:#f0f0f0}50%{background-color:#e8e8e8}100%{background-color:#f0f0f0}}
        .drag-over{animation:pulseBg 1.5s infinite;border-color:#00796b;box-shadow:none}
        @keyframes elasticDrop{0%{transform:scale(1.1);opacity:.8}40%{transform:scale(.9);opacity:1}70%{transform:scale(1.05)}100%{transform:scale(1.0)}}
        .dropped .kart-bitis{animation:elasticDrop .4s cubic-bezier(0.175, 0.885, 0.32, 1.275)}
        .birakma-alani.dogru{background-color:transparent; border-style: solid; border-color: transparent;}
        .kart-bitis.dogru{background-color:#e8f5e9;border-color:#4caf50;opacity:1}
        @keyframes vibrate{0%,100%{transform:translateX(0)}10%,30%,50%,70%,90%{transform:translateX(-4px)}20%,40%,60%,80%{transform:translateX(4px)}}
        .yanlis-anim{animation:vibrate .3s;background-color:#ffebee;border-color:#f44336}
        
        .buton-alani {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
            min-height: 80px;
        }
        
        .buton{display:block;padding:10px 40px;font-family:'Markazi Text',serif;font-size:2.6rem;font-weight:600;color:#fff;background-color:#00796b;border:none;border-radius:16px;cursor:pointer;transition:background-color .3s,transform .2s}
        .buton:hover{background-color:#004d40}
        
        #backBtn {
            position: absolute;
            top: 30px;
            left: 30px;
            background: transparent;
            border: none;
            cursor: pointer;
            z-index: 1000;
            padding: 10px;
            transition: transform 0.2s ease;
            outline: none;
        }
        #backBtn:hover { transform: scale(1.1); }
        #backBtn svg { width: 60px; height: 60px; fill: #00796b; }

        #checkBtn{background-color:#4CAF50;font-size:3.6rem;padding:4px 30px;display:none}
        #checkBtn:hover{background-color:#388E3C}
        
        /* Bitiş Ekranı */
        #end-screen {
            position: absolute; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.95);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            text-align: center;
        }
        #end-screen h2 { font-size: 5rem; color: #00796b; margin-bottom: 20px; }
        #end-screen p { font-size: 3rem; color: #333; }

    </style>
</head>
<body>

    <div id="game-container">
        <button id="backBtn" onclick="window.location.href='index.html'">
            <svg viewBox="0 0 24 24">
                <path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" />
            </svg>
        </button>

        <header>
            <h1>أَكْمِل الجُمْلة</h1>
            <div id="level-indicator">الجَوْلَة 1 / 4</div>
        </header>
        
        <div class="etkilesim-alani">
            <div class="cumleler-kutusu" id="questions-box"></div>
            <div class="secenekler-kutusu" id="options-box"></div>
        </div>
        
        <div class="buton-alani">
            <button id="checkBtn" class="buton">&#10004;</button> 
        </div>

        <div id="end-screen">
            <h2>مُمْتاز!</h2>
            <p>لَقَد أَنْهَيْتَ كُلّ المَراحِل بِنَجاح.</p>
            <br>
            <button class="buton" onclick="location.reload()">إِعادَة</button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- 2. ÜNİTE VERİ SETİ (4 TUR x 5 SORU = 20 CÜMLE) ---
            const gameData = [
    // 1. Tur: Sabah Rutini (Güne Başlama)
    // Öğrenci burada eylemlerin sıralamasını ve sabah yapılan işleri eşleştirir.
    {
        questions: [
            { q: "مَتى اسْتَيْقَظْتَ؟", a: "اِسْتَيْقَظْتُ صَباحًا." },          // Ne zaman uyandın? -> Sabah uyandım.
            { q: "ماذا فَعَلْتَ بَعْد النَّوْم؟", a: "تَوَضَّأْتُ وَصَلَّيْتُ الفَجْر." }, // Uyuduktan sonra ne yaptın? -> Abdest alıp sabah namazı kıldım.
            { q: "ماذا تَناوَلْتَ؟", a: "تَناوَلْتُ الفُطور." },              // Ne yedin? -> Kahvaltı yaptım.
            { q: "هَلْ خَرَجْتَ مِن البَيْت؟", a: "نَعَم، خَرَجْتُ مِن البَيْت." }, // Evden çıktın mı? -> Evet, evden çıktım.
            { q: "أَيْن ذَهَبْتَ صَباحًا؟", a: "ذَهَبْتُ إِلى المَدْرَسَة." }  // Sabah nereye gittin? -> Okula gittim.
        ],
        distractor: "مَساءً" // Çeldirici: Akşam (Sabah rutini için yanlış zaman)
    },

    // 2. Tur: Okul ve Ulaşım (Mazi Fiil - Ben/Sen)
    // Araç kullanımı ve okula gidiş detayları.
    {
        questions: [
            { q: "كَيْف ذَهَبْتَ إِلى المَدْرَسَة؟", a: "رَكِبْتُ الحافِلَة." }, // Okula nasıl gittin? -> Otobüse bindim.
            { q: "مَتى رَكِبْتَ الحافِلَة؟", a: "في السّاعَة الثّامِنَة." },   // Otobüse ne zaman bindin? -> Saat 8'de.
            { q: "ماذا فَعَلْتَ في المَدْرَسَة؟", a: "دَرَسْتُ اللُّغَةِ العَرَبِيَّة." }, // Okulda ne yaptın? -> Arapça çalıştım.
            { q: "أَيْن لَعِبْتَ؟", a: "لَعِبْتُ في حَديقَة المَدْرَسَة." },   // Nerede oynadın? -> Okul bahçesinde.
            { q: "هَل قَرَأْت القُرْآن؟", a: "نَعَم، قَرَأْتُ القُرْآن الكَريم." } // Kuran okudun mu? -> Evet...
        ],
        distractor: "المُسْتَشْفى" // Çeldirici: Hastane (Okul bağlamı dışı)
    },

    
    // 3. Tur: Aktiviteler ve Zaman (Güncellenmiş)
    // Sadece saat sormak yerine; ne okuduğu, kim olduğu ve ne zaman ödev yaptığı gibi çeşitlendirildi.
    {
        questions: [
            { q: "ماذا قَرَأْتَ اليَوْم؟", a: "قَرَأْتُ القُرْآن الكَريم." },      // Bugün ne okudun? -> Kuran-ı Kerim okudum.
            { q: "مَن هِيَ مَرْوَة؟", a: "هِيَ أُخْت عاصِم." },                    // Merve kimdir? -> Asım'ın kız kardeşidir.
            { q: "أَيْن يَدْرُسُ عاصِم؟", a: "في المَدْرَسَة الثّانَوِيَّة." },     // Asım nerede okuyor? -> Lisede.
            { q: "مَتى كَتَبْتَ واجِباتِكَ؟", a: "كَتَبْتُ واجِباتي مَساءً." },     // Ödevlerini ne zaman yazdın? -> Ödevlerimi akşam yazdım. (Saat yerine vakit ismi)
            { q: "مَتى تَناوَلْتَ الفُطور؟", a: "في السّاعَة السّادِسَة." }      // Kahvaltıyı ne zaman yaptın? -> Saat 6'da. (Tek bir net saat sorusu bıraktık)
        ],
        distractor: "الحافِلَة" // Çeldirici: Otobüs (Bu sorulara mantıksız bir cevap)
    },
    // 4. Tur: O (Huwa/Hiya) ve Başkaları Hakkında Konuşma
    // 3. Tekil şahıs (Müzekker/Müennes) ayrımı.
    {
        questions: [
            { q: "مَنْ هُو عاصِم؟", a: "هُو طالِب في الثّانَوِيَّة." },            // Asım kimdir? -> Lisede öğrencidir.
            { q: "مَع مَنْ لَعِبَ عاصِم؟", a: "لَعِبَ مَع صَديقه." },          // Asım kimle oynadı? -> Arkadaşıyla.
            { q: "ماذا فَعَلَتْ مَرْوَة؟", a: "هِيَ ذاكَرَتْ دُروسَها." },        // Merve ne yaptı? -> Derslerini çalıştı.
            { q: "أَيْن ذَهَبَتْ نورَة؟", a: "ذَهَبَتْ إِلى قونْيا." },        // Nura nereye gitti? -> Konya'ya.
            { q: "أَيْن ذَهَبَ حَسَن؟", a: "ذَهَبَ إِلى المُسْتَشْفى." }         // Hasan nereye gitti? -> Hastaneye.
        ],
        distractor: " أَنا طالِب" // Çeldirici: Ben (Sorular 'O' hakkında olduğu için 'Ben' yanlıştır)
    }
];

            let currentRoundIndex = 0;
            let doluSlotSayisi = 0;
            
            const gameContainer = document.getElementById('game-container');
            const questionsBox = document.getElementById('questions-box');
            const optionsBox = document.getElementById('options-box');
            const checkBtn = document.getElementById('checkBtn');
            const levelIndicator = document.getElementById('level-indicator');
            const endScreen = document.getElementById('end-screen');

            // --- Ekran Ölçekleme ---
            const BASE_WIDTH = 1920;  
            const BASE_HEIGHT = 1080; 
            function resizeGame() {
                const windowWidth = window.innerWidth;
                const windowHeight = window.innerHeight;
                const scaleX = windowWidth / BASE_WIDTH;
                const scaleY = windowHeight / BASE_HEIGHT;
                const scale = Math.min(scaleX, scaleY);
                document.documentElement.style.setProperty('--scale', scale); 
                gameContainer.style.transform = `translate(-50%, -50%) scale(${scale})`;
            }
            resizeGame();
            window.addEventListener('resize', resizeGame);
            
            // --- Ses Efektleri ---
            let audioCtx = null; 
            gameContainer.addEventListener('pointerdown', initAudio, { once: true });
            function initAudio() {
                if (audioCtx) return; 
                try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); } 
                catch (e) { console.error('Audio API hatası'); }
            }
            function playSound(type) {
                if (!audioCtx) return; 
                const oscillator = audioCtx.createOscillator();
                const gainNode = audioCtx.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioCtx.destination);
                const now = audioCtx.currentTime;
                gainNode.gain.setValueAtTime(0.3, now); 
                if (type === 'drop') {
                    oscillator.type = 'triangle'; oscillator.frequency.setValueAtTime(300, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    oscillator.start(now); oscillator.stop(now + 0.2);
                } else if (type === 'wrong') {
                    oscillator.type = 'square'; oscillator.frequency.setValueAtTime(150, now);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.2);
                    oscillator.start(now); oscillator.stop(now + 0.2);
                } else if (type === 'win') {
                    oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(500, now);
                    oscillator.frequency.exponentialRampToValueAtTime(1000, now + 0.1);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.5);
                    oscillator.start(now); oscillator.stop(now + 0.5);
                }
            }

            // --- Oyunu Başlat / Tur Yükle ---
            function loadRound(roundIdx) {
                // Temizlik
                questionsBox.innerHTML = '';
                optionsBox.innerHTML = '';
                checkBtn.style.display = 'none';
                doluSlotSayisi = 0;
                
                if (roundIdx >= gameData.length) {
                    endScreen.style.display = "flex";
                    playSound('win');
                    return;
                }

                levelIndicator.textContent = `الجَوْلَة ${roundIdx + 1} / ${gameData.length}`;
                
                const currentData = gameData[roundIdx];
                const questions = currentData.questions;
                
                // Soruları oluştur
                questions.forEach((item, index) => {
                    const row = document.createElement('div');
                    row.className = 'cumle-satiri';
                    
                    const textDiv = document.createElement('div');
                    textDiv.className = 'cumle-baslangic';
                    textDiv.textContent = item.q;
                    
                    const dropZone = document.createElement('div');
                    dropZone.className = 'birakma-alani';
                    dropZone.dataset.id = index; // 0,1,2,3,4
                    
                    row.appendChild(textDiv);
                    row.appendChild(dropZone);
                    questionsBox.appendChild(row);
                });

                // Seçenekleri oluştur (Doğrular + Yanıltıcı)
                let optionsArr = questions.map((item, index) => ({ text: item.a, id: index }));
                // Yanıltıcı şıkkı ekle (id'si eşleşmeyecek bir sayı, örn: 99)
                optionsArr.push({ text: currentData.distractor, id: 99 });

                // Karıştır
                optionsArr.sort(() => Math.random() - 0.5);

                optionsArr.forEach(opt => {
                    const card = document.createElement('div');
                    card.className = 'kart-bitis';
                    card.draggable = true;
                    card.dataset.id = opt.id;
                    card.textContent = opt.text;
                    
                    // Event listenerları ekle (önceki koddan mantık aynı)
                    card.addEventListener('dragstart', dragStartHandler);
                    card.addEventListener('dragend', dragEndHandler);
                    // Mobil için touch
                    card.addEventListener('touchstart', dragStartHandler, {passive: false});
                    
                    optionsBox.appendChild(card);
                });

                // Dropzone eventleri
                const zones = document.querySelectorAll('.birakma-alani');
                zones.forEach(zone => {
                    zone.addEventListener('dragover', dragOver);
                    zone.addEventListener('dragleave', dragLeave);
                    zone.addEventListener('drop', dropHandler);
                });
                
                // Seçenek kutusuna geri bırakma eventleri
                optionsBox.addEventListener('dragover', (e) => e.preventDefault());
                optionsBox.addEventListener('drop', dropToContainer);
            }

            // --- Drag & Drop Fonksiyonları ---
            let draggedCard = null;
            let ghostElement = null;

            function dragStartHandler(e) {
                if (e.target.classList.contains('siluet') || e.target.classList.contains('dogru')) {
                    e.preventDefault(); return;
                }
                draggedCard = e.target;
                if (e.dataTransfer) e.dataTransfer.setData('text/plain', e.target.dataset.id);
                
                // Ghost image (mobil uyumluluk ve görsel için)
                if (!('ontouchstart' in window)) {
                    ghostElement = e.target.cloneNode(true);
                    ghostElement.classList.add('drag-ghost');
                    document.body.appendChild(ghostElement);
                    e.dataTransfer.setDragImage(ghostElement, e.offsetX, e.offsetY);
                }
                setTimeout(() => { if(draggedCard) draggedCard.classList.add('dragging'); }, 0);
            }

            function dragEndHandler(e) {
                if (ghostElement) ghostElement.remove();
                if (draggedCard) draggedCard.classList.remove('dragging');
                draggedCard = null;
            }

            function dragOver(e) {
                e.preventDefault();
                if (!this.querySelector('.kart-bitis')) {
                    this.classList.add('drag-over');
                }
            }

            function dragLeave(e) {
                this.classList.remove('drag-over');
            }

            function dropHandler(e) {
                e.preventDefault();
                this.classList.remove('drag-over');
                
                if (!draggedCard || this.querySelector('.kart-bitis')) return;

                // Kartı taşıma mantığı
                // Eğer kart listeden geliyorsa (klonlanacaksa/siluet olacaksa)
                // Bu tasarımda direkt taşıma yapıyoruz, kopyalama değil.
                
                if (draggedCard.parentElement.classList.contains('secenekler-kutusu')) {
                    // Ana kutudan slota
                    this.appendChild(draggedCard);
                    doluSlotSayisi++;
                } else {
                    // Slottan slota
                    this.appendChild(draggedCard);
                    // Dolu slot sayısı değişmez
                }
                
                playSound('drop');
                checkButtonState();
            }

            function dropToContainer(e) {
                e.preventDefault();
                if (draggedCard && draggedCard.parentElement.classList.contains('birakma-alani')) {
                    optionsBox.appendChild(draggedCard);
                    doluSlotSayisi--;
                    checkButtonState();
                }
            }

            function checkButtonState() {
                // Sadece o turdaki soru sayısı kadar slot dolduysa butonu göster
                // (Yanıltıcı şık olduğu için toplam kart sayısı slot sayısından fazla)
                const currentQuestionCount = gameData[currentRoundIndex].questions.length;
                if (doluSlotSayisi === currentQuestionCount) {
                    checkBtn.style.display = 'block';
                } else {
                    checkBtn.style.display = 'none';
                }
            }

            // --- Kontrol Butonu ---
            checkBtn.addEventListener('click', () => {
                let tumuDogru = true;
                const zones = document.querySelectorAll('.birakma-alani');
                
                zones.forEach(zone => {
                    const card = zone.querySelector('.kart-bitis');
                    if (!card) return;

                    // Önceki sınıfları temizle
                    card.classList.remove('yanlis-anim', 'dogru');

                    if (card.dataset.id === zone.dataset.id) {
                        // Doğru
                        card.classList.add('dogru');
                        card.draggable = false;
                        card.style.cursor = 'default';
                        zone.classList.add('dogru'); // Çerçeveyi kaldırır
                    } else {
                        // Yanlış
                        tumuDogru = false;
                        card.classList.add('yanlis-anim');
                        playSound('wrong');
                        
                        // Yanlış olanı geri gönder
                        setTimeout(() => {
                            card.classList.remove('yanlis-anim');
                            optionsBox.appendChild(card);
                            doluSlotSayisi--;
                            checkButtonState();
                        }, 800);
                    }
                });

                if (tumuDogru) {
                    playSound('win');
                    checkBtn.style.display = 'none';
                    
                    // Sonraki tura geçiş
                    setTimeout(() => {
                        currentRoundIndex++;
                        loadRound(currentRoundIndex);
                    }, 1500); // 1.5 saniye bekle ve diğer tura geç
                }
            });

            // Başlangıç
            loadRound(0);

        });
    </script>
</body>
</html>