<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> ØªÙ…Ø±ÙŠÙ† Ù…Ù„Ø¡ Ø§Ù„ÙØ±Ø§Øº</title>
    <link href="https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* 1. ARAKOM.TTF dosyasÄ±nÄ± sisteme tanÄ±tÄ±yoruz */
   @font-face {
        font-family: 'Arakom';
        src: url('ARAKOM.TTF') format('truetype'),
             url('arakom.ttf') format('truetype'),
             url('Arakom.ttf') format('truetype');
        font-weight: normal;
        font-style: normal;
    }

    /* 2. DeÄŸiÅŸkenleri ve Fontu Zorluyoruz */
    :root {
        --accent-color: #007bff;
        --success-color: #28a745;
        --danger-color: #dc3545;
        --bg-light: #f8f9fa;
        
        /* Fontu 'Arakom' olarak gÃ¼ncelledik */
        --font-arabic: 'Arakom', 'Markazi Text', 'Tahoma', 'Arial', sans-serif;
    }

    /* 3. Ã–NEMLÄ°: Body ve TÃœM BUTONLAR iÃ§in fontu zorluyoruz */
    body, button, input, .key, .answer-input {
        font-family: var(--font-arabic) !important; /* !important ile baskÄ±n kÄ±ldÄ±k */
        font-weight: 400;
    }

        body {
            font-family: var(--font-arabic);
            background-color: #e9ecef;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
            font-weight: 400;
        }

        /* --- Ana Etkinlik AlanÄ± (MASAÃœSTÃœ BOYUTLARI KORUNDU) --- */
        /* --- Ana Etkinlik AlanÄ± (MasaÃ¼stÃ¼ Ä°yileÅŸtirmesi) --- */
.activity-container {
    aspect-ratio: 16 / 9;
    position: relative;
    background: #ffffff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    display: none;
    flex-direction: column;
    
    /* GÃœNCELLEME: Minimum geniÅŸlik ve yÃ¼kseklik eklendi */
    width: 95vw;
    max-width: 1200px; /* Ã‡ok geniÅŸ ekranlarda devasa olmamasÄ± iÃ§in */
    min-width: 800px;  /* Tam ekrandan Ã§Ä±kÄ±nca aÅŸÄ±rÄ± kÃ¼Ã§Ã¼lmeyi engeller */
    
    height: auto; 
    min-height: 500px; /* Ä°Ã§eriÄŸin sÄ±kÄ±ÅŸmasÄ±nÄ± Ã¶nler */
    margin: auto;
}

/* --- Cevap Kutusu (Yatayda GeniÅŸ, Soruyla Uyumlu) --- */
.answer-input {
    font-family: var(--font-arabic);
    border: 2px solid var(--accent-color);
    border-radius: 8px;
    padding: 10px 20px;
    
    /* GÃœNCELLEME: Yatayda daha geniÅŸ yapÄ±ldÄ± */
    width: 400px; 
    min-width: 250px;
    max-width: 80%;
    
    height: 80px; /* YÃ¼ksekliÄŸi biraz azaltÄ±ldÄ± */
    line-height: 1.2;
    font-size: 0.8em; /* Soru metninden biraz daha kÃ¼Ã§Ã¼k olmasÄ± iÃ§in */
    
    background: #f8f9fa;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin: 0 15px;
    font-weight: 700;
}

/* --- Soru Metni (Boyutu Dengelendi) --- */
.question-text {
    /* GÃœNCELLEME: clamp deÄŸerleri kÃ¼Ã§Ã¼ltÃ¼ldÃ¼ */
    font-size: clamp(1.5rem, 3.5vw, 4rem); 
    font-weight: 700;
    color: #212529;
    margin-bottom: 20px;
    line-height: 1.4;
    text-align: center;
}

        body.fullscreen .activity-container {
            width: 100vw;
            height: calc(100vw * 9 / 16); 
            max-height: 100vh;
            max-width: calc(90vh * 16 / 9);
            border-radius: 0;
            box-shadow: none;
        }

        /* ğŸ”¥ OYUN BAÅLAMADAN ANA EKRAN ELEMENTLERÄ°NÄ° GÄ°ZLEME */
        .header, .activity-area {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s 0.3s;
        }
        /* ğŸ”¥ OYUN BAÅLAYINCA GÃ–STERME */
        body.game-started .header, body.game-started .activity-area {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease, visibility 0s;
        }

        .back-button-container {
            grid-area: back;
            display: flex;
            justify-content: flex-end; 
            align-items: center; 
            gap: 10px;           
        }
        .back-button {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            text-decoration: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .back-button:hover { background: #e0e0e0; }
        .back-button svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }

        /* --- BaÅŸlÄ±k ve Ä°lerleme --- */
        .header {
            padding: 15px 25px;
            border-bottom: 1px solid #dee2e6;
            display: grid;
            grid-template-areas: "progress instruction back"; 
            grid-template-columns: 310px 1fr 310px;
            align-items: center;
            gap: 20px;
        }
        
        #instruction-text { 
            grid-area: instruction;
            text-align: center; 
            font-size: clamp(1.8rem, 2.2vw, 3rem); 
            font-weight: 700;
            color: #555;
        }
        
        .progress-container { 
            grid-area: progress;
            display: flex;
            align-items: center;
            gap: 15px;
            justify-content: flex-start;
            width: 310px;
            direction: ltr; 
        }
        #progress-display {
            font-size: 1.5rem; 
            font-weight: bold;
            color: var(--accent-color);
            flex-shrink: 0;
        }
        .progress-bar-container {
            flex-grow: 1;
            height: 12px;
            background-color: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--accent-color);
            transition: width 0.4s ease, background-color 0.4s ease;
        }

        #fullscreen-btn {
            background: #f0f0f0;
            color: #555;
            border: 1px solid #ccc;
            border-radius: 1.5vmin;
            cursor: pointer;
            width: clamp(40px, 8vmin, 55px);
            height: clamp(40px, 8vmin, 55px);
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        #fullscreen-btn:hover { background: #e0e0e0; }
        #fullscreen-btn svg {
            width: clamp(24px, 5vmin, 30px);
            height: clamp(24px, 5vmin, 30px);
            fill: currentColor;
        }
        #fullscreen-btn .icon-open { display: block; }
        #fullscreen-btn .icon-close { display: none; }
        body.fullscreen #fullscreen-btn .icon-open { display: none; }
        body.fullscreen #fullscreen-btn .icon-close { display: block; }

        /* --- Etkinlik AlanÄ± --- */
        .activity-area {
            flex-grow: 1;
            padding: 10px 20px; 
            display: flex;
            flex-direction: column;
            justify-content: flex-start; 
            overflow-y: auto;
            padding-top: 15px; 
        }

        .fill-in-blank-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            height: 100%;
            justify-content: center; 
            padding-bottom: 20px; 
        }
        .question-text {
            /* MASAÃœSTÃœ boyutu korundu */
            font-size: clamp(2rem, 5vw, 5.5rem);
            font-weight: 700;
            color: #212529;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            justify-content: center;
            line-height: 1.5;
            white-space: normal; 
            text-align: center;
        }
      .answer-input {
        font-family: var(--font-arabic);
        border: 2px solid var(--accent-color);
        border-radius: 8px;
        padding: 15px 15px; 
        width: 375px;
        max-width: 80%;
        text-align: center;
        margin: 10 15px;
        
        /* ğŸ”¥ SABÄ°T YÃœKSEKLÄ°K VE LINE-HEIGHT */
        height: 110px; 
        line-height: 1.6; 
        
        background: #f8f9fa;
        direction: rtl; 
        color: #333;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-size: 0.9em; 
        font-weight: 700;
    }
        
        /* --- Klavye Stilleri --- */
        .keyboard-container {
            width: 100%;
            margin-top: 10px;
            direction: rtl; 
            user-select: none;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .key-row {
            display: flex;
            justify-content: center;
            gap: 0.8vw; 
            margin-bottom: 0.8vw;
        }

        .key-container {
            /* MASAÃœSTÃœ boyutu korundu */
            position: relative;
            flex-grow: 1;
            flex-basis: 0;
            max-width: 80px;
            height: clamp(50px, 7vh, 75px);
        }

        .key {
            /* MASAÃœSTÃœ boyutu korundu */
            font-family: var(--font-arabic);
            font-size: clamp(1.4rem, 2vw, 2.5rem);
            font-weight: 700;
            width: 100%;
            height: 100%;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.1s ease;
            border: none;
            position: absolute;
            top: 0; left: 0;
        }
        .key:active { transform: scale(0.95); }
        .key.backspace { font-size: 1.5rem; color: white; }

        /* Uzun Basma Popup */
        .long-press-popup {
            position: absolute;
            bottom: 115%;
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
            gap: 5px;
            padding: 8px;
            z-index: 1000;
        }
        
        .long-press-popup.show {
            display: flex;
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .variant-key {
            /* MASAÃœSTÃœ boyutu korundu */
            font-family: var(--font-arabic);
            font-size: clamp(1.4rem, 2vw, 2.5rem);
            font-weight: bold;
            width: clamp(50px, 7vh, 75px);
            height: clamp(50px, 7vh, 75px);
            display: flex;
            align-items: center;
            justify-content: center;
            background: #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
            color: #333;
            box-shadow: 0 4px 5px rgba(0,0,0,0.1);
        }
        .variant-key:hover { background: var(--accent-color); color: white; }

        @keyframes popIn {
            from { opacity: 0; transform: translateX(-50%) scale(0.5); }
            to { opacity: 1; transform: translateX(-50%) scale(1); }
        }

        /* --- Kontrol ButonlarÄ± --- */
        #check-scramble-btn, #reset-scramble-btn {
            padding: 15px 30px;
            font-size: 2rem; 
            font-family: var(--font-arabic);
            font-weight: 700;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, opacity 0.2s;
            margin: 5px;
        }
        #check-scramble-btn { background-color: var(--success-color); color: white; }
        #reset-scramble-btn { background-color: var(--danger-color); color: white; }
        
        #check-scramble-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
            opacity: 0.6;
            transform: none;
        }

        .scramble-controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }

        /* --- Geri Bildirim --- */
        .feedback-overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center; align-items: center;
            font-size: 10rem;
            z-index: 200;
            visibility: hidden; opacity: 0;
            transition: opacity 0.3s ease;
        }
        .feedback-overlay.show { visibility: visible; opacity: 1; }
        .feedback-overlay .correct { color: var(--success-color); }
        .feedback-overlay .incorrect { color: var(--danger-color); }
        
        #feedback-details {
            display: none; 
            flex-direction: column; align-items: center;
            position: absolute; bottom: 5%; width: 100%;
        }
        #feedback-correct-answer {
            font-size: 4rem; 
            font-weight: 700; color: #333;
            background: #fff; padding: 10px 20px;
            border-radius: 10px; border: 2px solid #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            max-width: 90%;
            text-align: center;
        }
        #feedback-ok-button {
            font-size: 2.5rem; font-weight: 700; color: white;
            background-color: var(--success-color);
            border: none; border-radius: 50%;
            width: 70px; height: 70px;
            cursor: pointer; margin-top: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* --- BitiÅŸ --- */
        #finish-screen {
            text-align: center; font-weight: 700; color: var(--accent-color);
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            height: 100%;
        }
        #finish-screen p { font-size: 3.5rem; margin: 10px 0; }
        .score-display {
            display: flex; gap: 30px; font-size: 2.8rem; 
            margin: 10px 0; direction: ltr;
        }
        .score-item { font-weight: 700; }
        .score-correct { color: var(--success-color); }
        .score-incorrect { color: var(--danger-color); }
        #replay-button {
            font-size: 4.5rem; background: none; border: none;
            cursor: pointer; padding: 10px; border-radius: 50%;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        #replay-button:hover { transform: rotate(-90deg); background-color: #f0f0f0; }
        
        #start-screen {
    position: fixed; /* Absolute yerine Fixed */
    top: 0; 
    left: 0;
    width: 100vw; 
    height: 100vh;
    background: #e9ecef; /* Sayfa arka plan rengiyle aynÄ± olsun */
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 2000; /* En Ã¼stte durmasÄ± iÃ§in artÄ±rdÄ±k */
}
        
        #start-button {
            padding: 20px 40px; 
            font-size: 3rem; 
            font-weight: 700; 
            background-color: var(--accent-color); 
            color: white; 
            border: none; 
            border-radius: 12px; 
            cursor: pointer;
            transition: background-color 0.2s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        #start-button:hover {
            background-color: #0056b3; 
        }

        /* ------------------------------------------------------------------ */
        /* --- YATAY MOD UYARISI STÄ°LLERÄ° --- */
        /* ------------------------------------------------------------------ */
        
        #rotate-message {
            position: fixed;
            top: 0; left: 0;
            width: 100vw; height: 100vh;
            background-color: #343a40; 
            color: white;
            display: none; /* BaÅŸlangÄ±Ã§ta gizli */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            z-index: 5000;
            font-family: var(--font-arabic);
        }

        #rotate-message p {
            font-size: clamp(1.5rem, 4vw, 3rem);
            margin: 15px 0;
            line-height: 1.5;
            font-weight: 700;
        }

        .phone-animation {
            background: var(--accent-color);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 30px;
            animation: rotate-phone 2s infinite ease-in-out;
        }

        @keyframes rotate-phone {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }

        /* YALNIZCA DÄ°KEY (PORTRAIT) MOD KONTROLÃœ */
        @media only screen and (orientation: portrait) {
            #rotate-message { display: flex; } /* Dikeyde uyarÄ±yÄ± gÃ¶ster */
            .activity-container { display: none; } /* Dikeyde aktiviteyi gizle */
        }

      /* ------------------------------------------------------------------ */
/* --- MOBÄ°L YATAY (LANDSCAPE) MOD KÃœÃ‡ÃœLTME YAMASI (TAM SÃœRÃœM) --- */
/* ------------------------------------------------------------------ */
@media only screen and (max-height: 900px) and (orientation: landscape) {
    
    /* --- Genel DÃ¼zen ve BaÅŸlÄ±k --- */
    .header {
        padding: 5px 10px;
        gap: 10px;
        grid-template-columns: 200px 1fr 200px; 
        border-bottom: 1px solid #eee;
    }
    
    #instruction-text {
        font-size: clamp(1.2rem, 1.8vw, 2rem); 
    }
    
    .progress-container { 
        width: 180px; 
        gap: 8px; 
    }
    #progress-display { font-size: 1rem; }
    .progress-bar-container { height: 6px; }
    
    .back-button, #fullscreen-btn {
        width: 35px;
        height: 35px;
    }
    .back-button svg, #fullscreen-btn svg {
         width: 20px;
         height: 20px;
    }

    /* --- Soru ve Cevap AlanÄ± --- */
    .activity-area {
        padding-top: 5px;
    }

    .question-text {
         font-size: clamp(1.5rem, 4vw, 3rem); 
         margin-bottom: 8px;
    }

    .answer-input {
        width: 140px; 
        height: 45px !important; 
        line-height: 1.2 !important; 
        padding: 5px 10px;
        margin: 0 8px;
        font-size: 1.5rem;
    }
    
    /* --- Klavye DÃ¼zeni --- */
    .keyboard-container {
        padding: 0 2px;
        margin-top: 2px;
    }
    .key-row {
        gap: 8px; /* TuÅŸlar arasÄ±ndaki yatay boÅŸluk artÄ±rÄ±ldÄ± */
        margin-bottom: 8px; /* SatÄ±rlar arasÄ±ndaki dikey boÅŸluk artÄ±rÄ±ldÄ± */
        justify-content: center;
    }
    .key-container {
        max-width: 55px;
        height: clamp(35px, 9vh, 50px); 
    }
    .key, .variant-key { 
        font-size: clamp(1.1rem, 1.5vw, 1.8rem); 
        border-radius: 6px; /* TuÅŸ kÃ¶ÅŸelerini biraz yumuÅŸattÄ±k */
    }
    .key.backspace { font-size: 1rem; }

    /* --- Kontrol ButonlarÄ± --- */
    #check-scramble-btn, #reset-scramble-btn {
        padding: 8px 20px;
        font-size: 1.1rem;
        margin-top: 5px;
    }

   .feedback-overlay {
        flex-direction: column; 
        justify-content: center; /* DÄ°KEYDE TAM ORTALAR */
        align-items: center;    /* YATAYDA TAM ORTALAR */
        padding-top: 0;         /* Ãœst boÅŸluÄŸu kaldÄ±rdÄ±k */
        background: rgba(255, 255, 255, 0.98);
    }

    #feedback-icon {
        font-size: 18vh; /* Ã‡arpÄ±/Tik boyutunu dikey yÃ¼ksekliÄŸe oranla */
        margin-bottom: 10px;
        line-height: 1;
        display: block;
        text-align: center;
    }

    #feedback-details {
        position: relative;
        bottom: auto;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        margin-top: 0;
    }

    #feedback-correct-answer {
        font-size: clamp(1.1rem, 5vh, 2rem) !important; /* Tek satÄ±ra sÄ±ÄŸacak ÅŸekilde kÃ¼Ã§Ã¼lÃ¼r */
        padding: 8px 20px;
        white-space: nowrap; /* Metni tek satÄ±rda tutar */
        overflow: hidden;
        text-overflow: ellipsis; /* TaÅŸarsa Ã¼Ã§ nokta koyar */
        max-width: 90%;
        margin-bottom: 15px;
        border-width: 1px;
        display: block;
    }

    #feedback-ok-button {
        width: 55px !important; 
        height: 55px !important; 
        font-size: 2rem !important; 
        margin-top: 0 !important;
        display: flex;
        align-items: center;
        justify-content: center;
        line-height: 1;
    }
}
    </style>
</head>
<body>
<div class="activity-container" id="main-container" style="display: none;">
        
        <div class="header">
            <div class="progress-container">
                <div id="progress-display">...</div> 
                <div class="progress-bar-container">
                    <div id="progress-bar"></div>
                </div>
            </div>
            
            <div id="instruction-text">...</div>

            <div class="back-button-container">
                <button id="fullscreen-btn">
                    <svg class="icon-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 10h2V7h3V5H5v5zM14 5v2h3v3h2V5h-5zM5 19v-5h2v3h3v2H5zM14 19v-2h3v-3h2v5h-5z"/>
                    </svg>
                    <svg class="icon-close" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/>
                    </svg>
                </button>

                <a href="index.html" class="back-button">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
            </div>
        </div>

        <div class="activity-area" id="activity-area"></div>

        <div class="feedback-overlay" id="feedback-overlay">
            <span id="feedback-icon"></span>
            <div id="feedback-details">
                <div id="feedback-correct-answer"></div>
                <button id="feedback-ok-button">âœ”</button>
            </div>
        </div>

    </div> <div id="start-screen">
        <button id="start-button">
            Ø§ÙØ¨Ù’Ø¯ÙØ£Ù’
        </button>
    </div>
    
    <div id="rotate-message">
        <div class="phone-animation">
            <svg viewBox="0 0 24 24" fill="#ffffff" width="60" height="60">
                <path d="M17 1H7C5.9 1 5 1.9 5 3v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2zm-2 20H9v-1h6v1zm2-3H7V6h10v12z" />
            </svg>
        </div>
    </div>

    <script>
        // --- KLAVYE TASARIMI ---
        const colorMap = {
            'Ø¨':'#a0c4ff','Øª':'#a0c4ff','Ø«':'#a0c4ff','Ù†':'#a0c4ff','ÙŠ':'#a0c4ff',
            'Ø¬':'#caffbf','Ø­':'#caffbf','Ø®':'#caffbf',
            'Ø¯':'#fdffb6','Ø°':'#fdffb6',
            'Ø±':'#ffd6a5','Ø²':'#ffd6a5',
            'Ø³':'#ffadad','Ø´':'#ffadad',
            'Øµ':'#bdb2ff','Ø¶':'#bdb2ff',
            'Ø·':'#9bf6ff','Ø¸':'#9bf6ff',
            'Ø¹':'#ffc6ff','Øº':'#ffc6ff',
            'Ù':'#b9f6ca','Ù‚':'#b9f6ca',
            'Ù‡':'#b3e5fc','Ø©':'#b3e5fc',
            'Ø¡':'#ffccbc','Ø¤':'#ffccbc','Ø¦':'#ffccbc',
            'Ø§':'#e0e0e0','Ù„':'#e0e0e0',
            'Ùƒ':'#d1c4e9',
            'm':'#f8bbd0', 
            'Ù…':'#f8bbd0',
            'Ùˆ':'#c5cae9'
        };
        const defaultColor='#FFFFFF';
        const backspaceBg = '#E53935';
        
        // --- UZUN BASMA VERÄ°SÄ° ---
        const longPressData = {
            'Ø§': ['Ø£', 'Ø¥', 'Ø¢'], 
            'ÙŠ': ['Ù‰', 'Ø¦'] 
        };
        
        function getDarkerColor(hex) {
            if (!hex || hex === '#FFFFFF') hex = '#CCCCCC'; 
            if (hex.length === 4) { 
                hex = `#${hex[1]}${hex[1]}${hex[2]}${hex[2]}${hex[3]}${hex[3]}`;
            }
            let r = parseInt(hex.slice(1, 3), 16);
            let g = parseInt(hex.slice(3, 5), 16);
            let b = parseInt(hex.slice(5, 7), 16);
            r = Math.floor(r * 0.85); 
            g = Math.floor(g * 0.85);
            b = Math.floor(b * 0.85);
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }
        
        const backspaceShadow = getDarkerColor(backspaceBg);
        
        const keyRows = [
            ["Ø¯","Ø¬","Ø­","Ø®","Ù‡","Ø¹","Øº","Ù","Ù‚","Ø«","Øµ","Ø¶"],
            ["Ø·","Ùƒ","Ù…","Ù†","Øª","Ø§","Ù„","Ø¨","ÙŠ","Ø³","Ø´","Ø°"],
            ["Backspace", "Ø¸","Ø²","Ùˆ","Ø©","Ù‰","Ø±","Ø¤","Ø¡","Ø¦"] 
        ];

  const activitiesData = [
    // 1. Saat Sorusu (5)
    { 
    pre: "Ø§Ù„Ø³Ù‘Ø§Ø¹ÙØ© (Ù¥:Ù Ù )", 
    post: "", 
    a: "Ø§Ù„Ø®Ø§Ù…ÙØ³ÙØ©", 
    hint: "5" 
    },
    // 2. Sabah Rutini
    { 
        pre: "Ø§ÙØ³Ù’ØªÙÙŠÙ’Ù‚ÙØ¸Ù’ØªÙ Ù…ÙÙ†", 
        post: "Ù…ÙØ¨ÙÙƒÙÙ‘Ø±Ù‹Ø§", 
        a: "Ø§Ù„Ù†ÙÙ‘ÙˆÙ’Ù…", 
        hint: "uyku" 
    },
    // 3. Ä°badet
    { 
    pre: "ØµÙÙ„ÙÙ‘ÙŠÙ’ØªÙ ÙÙŠ Ø§Ù„Ø³Ù‘Ø§Ø¹ÙØ© Ø§Ù„Ø®Ø§Ù…ÙØ³ÙØ©", 
    post: "", 
    a: ["Ø§Ù„Ù…ÙØºÙ’Ø±ÙØ¨","Ø§Ù„Ø¹ÙØµÙ’Ø±","Ø§Ù„ÙÙØ¬Ù’Ø±"], 
    hint: "sabah namazÄ±" 
    },
    // 4. KahvaltÄ±
    { 
        pre: "ØªÙÙ†Ø§ÙˆÙÙ„Ù’ØªÙ", 
        post: "ÙÙŠ Ø§Ù„ØµÙÙ‘Ø¨Ø§Ø­", 
        a: "Ø§Ù„ÙÙØ·ÙˆØ±", 
        hint: "kahvaltÄ±" 
    },
    // 5. UlaÅŸÄ±m
    { 
    pre: "Ø°ÙÙ‡ÙØ¨Ù’ØªÙ Ø¥ÙÙ„Ù‰ Ø§Ù„Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ© Ø¨ÙÙ€", 
    post: "", 
    a: ["Ø§Ù„Ø³ÙÙ‘ÙŠÙ‘Ø§Ø±ÙØ©","Ø§Ù„Ø¯ÙÙ‘Ø±Ù‘Ø§Ø¬ÙØ©","Ø§Ù„Ø­Ø§ÙÙÙ„ÙØ©"], 
    hint: "otobÃ¼s" 
    },
    // 6. Ders Ã‡alÄ±ÅŸmak
    {
        pre: "Ø°Ø§ÙƒÙØ±Ù’ØªÙ", 
        post: "ÙÙŠ Ø§Ù„ØºÙØ±Ù’ÙÙØ©", 
        a: ["Ø¯ÙØ±Ù’Ø³ÙŠ","ÙˆØ§Ø¬ÙØ¨ÙŠ","Ø§Ù„Ø¯ÙÙ‘Ø±Ù’Ø³","Ø§Ù„Ø¯ÙÙ‘Ø±ÙˆØ³","Ø§Ù„ÙˆØ§Ø¬ÙØ¨","Ø¯ÙØ±ÙˆØ³ÙŠ"], 
        hint: "derslerim" 
    },
    // 7. Saat Sorma
    { 
    pre: "", 
    post: " Ø§Ù„Ø³Ù‘Ø§Ø¹ÙØ© Ø§Ù„Ø¢Ù†ØŸ", 
    a: "ÙƒÙÙ…", 
    hint: "kaÃ§" 
    },
    // 8. Saat Sorusu (10)
    { 
    pre: "Ø§Ù„Ø³Ù‘Ø§Ø¹ÙØ© (Ù¡Ù :Ù Ù )", 
    post: "", 
    a: "Ø§Ù„Ø¹Ø§Ø´ÙØ±ÙØ©", 
    hint: "10" 
    },
    // 9. Yemek Tercihi
    { 
    pre: "", 
    post: " ØªÙØ­ÙØ¨ÙÙ‘ Ù…ÙÙ† Ø§Ù„Ù…ÙØ£Ù’ÙƒÙˆÙ„Ø§ØªØŸ", 
    a: "Ù…Ø§Ø°Ø§", 
    hint: "ne" 
     },
    // 10. Fiziksel Durum (AÃ§lÄ±k)
    { 
    pre: "Ø£ÙÙ†Ø§", 
    post: "ØŒ Ø£ÙØ±ÙŠØ¯Ù Ø£ÙÙ† Ø¢ÙƒÙÙ„Ù", 
    a: ["Ø¬Ø§Ø¦ÙØ¹,"Ø¬ÙÙˆÙ’Ø¹Ø§Ù†"], 
    hint: "aÃ§" 
    },
    // 11. Fiziksel Durum (Tokluk)
    { 
    pre: "", 
    post: " Ø§Ù„Ø·ÙÙ‘Ø¹Ø§Ù…ØŒ Ø§Ù„Ø­ÙÙ…Ù’Ø¯ Ù„Ù„Ù‡", 
    a: ["ØªÙÙ†Ø§ÙˆÙÙ„Ù’ØªÙ","Ø§ÙÙƒÙÙ„Ù’ØªÙ","Ø£ÙÙƒÙÙ„Ù’ØªÙ"], 
    hint: "yedim" 
    },
    // 12. Ä°Ã§ecek
    { 
        pre: "Ø£ÙØ´Ù’Ø±ÙØ¨Ù", 
        post: "Ø§Ù„Ø¨ÙØ±Ù’ØªÙÙ‚Ø§Ù„", 
        a: "Ø¹ÙØµÙŠØ±", 
        hint: "meyve suyu" 
    },
    // 13. KahvaltÄ± Ã‡eÅŸitleri
    { 
    pre: "ØªÙÙ†Ø§ÙˆÙÙ„Ù’ØªÙ", 
    post: "ÙÙŠ Ø§Ù„ÙÙØ·ÙˆØ±", 
    a: ["Ø§Ù„Ø¬ÙØ¨Ù’Ù†", "Ø§Ù„Ø²ÙÙ‘ÙŠÙ’ØªÙˆÙ†", "Ø§Ù„Ø¨ÙÙŠÙ’Ø¶", "Ø§Ù„Ø¹ÙØ³ÙÙ„", "Ø§Ù„Ø²ÙÙ‘Ø¨Ù’Ø¯ÙØ©", "Ø§Ù„Ù…ÙØ±ÙØ¨Ù‘Ù‰"], 
    hint: "peynir, zeytin, bal vb." 
     },
    // 14. Eve DÃ¶nÃ¼ÅŸ
    { 
    pre: "Ø±ÙØ¬ÙØ¹Ù’ØªÙ", 
    post: "Ø§Ù„Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ© Ø¸ÙÙ‡Ù’Ø±Ù‹Ø§", 
    a: "Ù…ÙÙ†Ù’", 
    hint: "-den, -dan (ayrÄ±lma)" 
    },
    // 15. Okuma Aktiviteleri
   {
    pre: "Ù‚ÙØ±ÙØ£Ù’ØªÙ", 
    post: "Ø§Ù„ÙƒÙØ±ÙŠÙ…", 
    a: ["Ø§Ù„Ù‚Ø±Ø§Ù†","Ø§Ù„Ù‚ÙØ±Ù’Ø¢Ù†"], 
    hint: "Kur'an-Ä± Kerim" 
   },
    // 16. Saat Sorusu (9)
    { 
    pre: "Ø§Ù„Ø³Ù‘Ø§Ø¹ÙØ© (Ù©:Ù Ù )", 
    post: "", 
    a: "Ø§Ù„ØªÙ‘Ø§Ø³ÙØ¹ÙØ©", 
    hint: "Ù©" 
    },
    // 17. Zaman ZarfÄ± (DÃ¼n)
   {
    pre: "Ø°ÙÙ‡ÙØ¨Ù’ØªÙ", 
    post: "Ø§Ù„Ø³Ù‘ÙˆÙ‚ Ø£ÙÙ…Ù’Ø³", 
    a: "Ø¥ÙÙ„Ù‰", 
    hint: "-e, -a (yÃ¶nelme)" 
    },
    // 18. Gece Rutini
    {
    pre: "Ø£ÙÙ†Ø§", 
    post: "Ø§Ù„Ø¹ÙØµÙŠØ± Ø§Ù„Ù€Ø¨Ø§Ø±ÙØ¯", 
    a: ["Ø£ÙØ´Ù’Ø±ÙØ¨Ù","Ø§ÙØ´Ù’Ø±ÙØ¨Ù","Ø£ÙØ­ÙØ¨Ù‘Ù","Ø§ÙØ­ÙØ¨Ù‘Ù","Ø´ÙØ±ÙØ¨Ù’ØªÙ"], 
    hint: "iÃ§tim (ben)" 
     },
    // 19. Ã–ÄŸle Vakti
    {
    pre: "Ø®ÙØ±ÙØ¬Ù’ØªÙ", 
    post: "Ø§Ù„Ù…ÙØ¯Ù’Ø±ÙØ³ÙØ© Ø¸ÙÙ‡Ù’Ø±Ù‹Ø§", 
    a: "Ù…ÙÙ†", 
    hint: "-den, -dan (ayrÄ±lma)" 
    },
    // 20. GeÃ§miÅŸ Zaman (MÃ¼ennes)
    { 
        pre: "Ù‡ÙÙŠÙ", 
        post: "Ø¥ÙÙ„Ù‰ Ø§Ù„Ù…ÙÙƒÙ’ØªÙØ¨ÙØ©", 
        a: ["ØªÙØ°Ù’Ù‡ÙØ¨Ù,Ø°ÙÙ‡ÙØ¨ÙØªÙ’"], 
        hint: "gitti (kÄ±z)" 
    }
];
        // --- Gerekli Elementler ---
        const activityArea = document.getElementById('activity-area');
        const instructionText = document.getElementById('instruction-text');
        const progressDisplay = document.getElementById('progress-display');
        const progressBar = document.getElementById('progress-bar');
        const feedbackOverlay = document.getElementById('feedback-overlay');
        const feedbackIcon = document.getElementById('feedback-icon');
        const feedbackDetails = document.getElementById('feedback-details');
        const feedbackCorrectAnswer = document.getElementById('feedback-correct-answer');
        const feedbackOkButton = document.getElementById('feedback-ok-button');
        const fullscreenButton = document.getElementById('fullscreen-btn');
        // ğŸ”¥ YENÄ° ELEMENTLER
        const startScreen = document.getElementById('start-screen');
        const startButton = document.getElementById('start-button');


        // --- Ses ---
        let audioCtx = null;
        function initAudioContext() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        }
        function playSound(type) {
            if (!audioCtx) return; 
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.type = 'sine';
            const now = audioCtx.currentTime;

            if (type === 'touch') {
                oscillator.frequency.setValueAtTime(200, now);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.1);
                oscillator.start(now);
                oscillator.stop(now + 0.1);
            } else if (type === 'correct') {
                oscillator.frequency.setValueAtTime(440, now);
                oscillator.frequency.linearRampToValueAtTime(880, now + 0.2);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.2);
                oscillator.start(now);
                oscillator.stop(now + 0.2);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, now);
                oscillator.frequency.linearRampToValueAtTime(150, now + 0.3);
                gainNode.gain.setValueAtTime(0.15, now);
                gainNode.gain.exponentialRampToValueAtTime(0.0001, now + 0.3);
                oscillator.start(now);
                oscillator.stop(now + 0.3);
            }
        }
        document.body.addEventListener('click', () => initAudioContext(), { once: true });

        // --- Oyun Durum DeÄŸiÅŸkenleri ---
        let allActivitiesData = [];     
        let activityQueue = [];         
        let currentActivityIndex = 0;   
        let grandTotalActivities = 0;   
        let currentRound = 0;           
        const questionsPerRound = 10;   
        let totalRounds = 0;            
        let totalQuestionsInGame = 0;   
        let scoreCorrect = 0;      
        let scoreIncorrect = 0; 

        // --- Tam Ekran ---
        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) document.exitFullscreen();
            }
        }
        function checkFullScreen() {
             if (document.fullscreenElement) document.body.classList.add('fullscreen');
             else document.body.classList.remove('fullscreen');
        }
        if(fullscreenButton) fullscreenButton.addEventListener('click', toggleFullScreen);
        document.addEventListener('fullscreenchange', checkFullScreen);

        // --- YardÄ±mcÄ± Fonksiyonlar ---
        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // **********************************************
        // *** NORMALÄ°ZASYON FONKSÄ°YONU ***
        // **********************************************
        function normalizeForCheck(text) {
            if (!text) return "";
            
            // 1. Hareke ve Tanvinleri KaldÄ±r
            let newText = text.replace(/[\u064B-\u065F]/g, ""); 
            
            return newText.trim(); 
        }

        function adjustFontSize(element) {
            element.style.fontSize = '';
            element.style.whiteSpace = 'normal';
            const baseFontSize = parseFloat(window.getComputedStyle(element).fontSize);
            const currentHeight = element.clientHeight;
            if (currentHeight > baseFontSize * 1.7) { 
                element.style.whiteSpace = 'nowrap';
                let currentFontSize = baseFontSize;
                while (element.scrollWidth > element.clientWidth && currentFontSize > 16) {
                    currentFontSize -= 1; 
                    element.style.fontSize = currentFontSize + 'px';
                }
            }
        }

        // --- ETKÄ°NLÄ°K YÃœKLEME ---
        function loadActivity() {
            activityArea.innerHTML = '';
            updateProgress(); 
            const activityData = activityQueue[currentActivityIndex]; 
            instructionText.textContent = "Ø§ÙÙ…Ù’Ù„ÙØ£ Ø§Ù„ÙÙØ±Ø§Øº Ø¨ÙØ§Ù„ÙƒÙÙ„ÙÙ…ÙØ© Ø§Ù„Ù…ÙÙ†Ø§Ø³ÙØ¨ÙØ©.";
            buildFillInTheBlank(activityData);
        }
        
        function buildFillInTheBlank(data) {
            const container = document.createElement('div');
            container.className = 'fill-in-blank-container';

            const questionText = document.createElement('div');
            questionText.className = 'question-text';
            
            const preText = document.createElement('span');
            preText.textContent = data.pre;
            
            const answerInput = document.createElement('div');
            answerInput.id = 'answer-input';
            answerInput.className = 'answer-input';
            
            let postContent = data.post; 
            if (postContent === "") postContent = "."; 
            else {
                const trimmedPost = postContent.trim();
                const lastChar = trimmedPost.charAt(trimmedPost.length - 1);
                if (['ØŸ','?','!'].includes(lastChar)) postContent = " " + postContent;
                else postContent = " " + postContent + "."; 
            }
            const postText = document.createElement('span');
            postText.textContent = postContent;
            
            questionText.appendChild(preText);
            questionText.appendChild(answerInput);
            questionText.appendChild(postText);
            
            container.appendChild(questionText);
            adjustFontSize(questionText);

            // Klavyeyi ekle
            container.appendChild(buildKeyboard()); 
            
            const controls = document.createElement('div');
            controls.className = 'scramble-controls'; 
            
            const checkButton = document.createElement('button');
            checkButton.id = 'check-scramble-btn';
            checkButton.textContent = 'âœ” ØªÙØ­ÙÙ‚ÙÙ‘Ù‚Ù’';
            checkButton.disabled = true; // BAÅLANGIÃ‡TA DEVRE DIÅI
            checkButton.onclick = () => {
                playSound('touch');
                checkFillInBlankAnswer(data.a); 
            };
            
            const resetButton = document.createElement('button');
            resetButton.id = 'reset-scramble-btn'; 
            resetButton.textContent = 'ğŸ”„ Ø§ÙÙ…Ù’Ø³ÙØ­Ù’'; 
            resetButton.onclick = () => {
                playSound('touch');
                const input = document.getElementById('answer-input');
                if(input) input.textContent = ''; 
                
                // Resetleyince doÄŸrulama butonunu tekrar kapat
                const checkBtn = document.getElementById('check-scramble-btn');
                if (checkBtn) checkBtn.disabled = true;
            };

            controls.appendChild(checkButton);
            controls.appendChild(resetButton);
            
            container.appendChild(controls);
            activityArea.appendChild(container);
        }

        // --- KLAVYE OLUÅTURUCU (Uzun Basma Ã–zellikli) ---
        function buildKeyboard() {
            const keyboardContainer = document.createElement('div');
            keyboardContainer.className = 'keyboard-container';

            keyRows.forEach(row => {
                const keyRow = document.createElement('div');
                keyRow.className = 'key-row';
                
                row.forEach(keyText => {
                    const keyContainer = document.createElement('div');
                    keyContainer.className = 'key-container';
                    if (keyText === 'Backspace') keyContainer.style.maxWidth = '110px';

                    const key = document.createElement('div');
                    key.className = 'key';
                    key.textContent = keyText;
                    
                    if (keyText === 'Backspace') {
                        key.classList.add('backspace');
                        key.innerHTML = 'âŒ«'; 
                        key.style.backgroundColor = backspaceBg;
                        key.style.boxShadow = `0 4px ${backspaceShadow}`;
                    } else {
                        const keyChar = keyText[0]; 
                        const color = colorMap[keyChar] || defaultColor;
                        key.style.backgroundColor = color;
                        key.style.boxShadow = `0 4px ${getDarkerColor(color)}`;
                    }

                    let pressTimer;
                    let isLongPress = false;

                    const startPress = (e) => {
                        e.preventDefault(); 
                        isLongPress = false;
                        
                        // Sadece 'Ø§' ve 'ÙŠ' iÃ§in uzun basma pop-up'Ä±nÄ± gÃ¶ster
                        if (longPressData[keyText]) {
                            pressTimer = setTimeout(() => {
                                isLongPress = true;
                                showVariants(keyText, keyContainer);
                                playSound('touch'); 
                            }, 500); 
                        }
                    };

                    const cancelPress = (e) => {
                        clearTimeout(pressTimer);
                        if (!isLongPress && e.type !== 'mouseleave') {
                            // EÄŸer bir pop-up aÃ§Ä±ksa, tuÅŸa normal basÄ±ÅŸ kabul edilmez.
                            if (!document.querySelector('.long-press-popup.show')) {
                                handleKeyInput(keyText);
                            }
                        }
                    };
                    
                    if (keyText === 'Backspace') {
                        key.onclick = () => handleKeyInput('Backspace');
                    } else {
                        key.addEventListener('mousedown', startPress);
                        key.addEventListener('touchstart', startPress, {passive: false});
                        
                        key.addEventListener('mouseup', cancelPress);
                        key.addEventListener('touchend', cancelPress);
                        key.addEventListener('mouseleave', () => clearTimeout(pressTimer));
                    }

                    keyContainer.appendChild(key);
                    keyRow.appendChild(keyContainer);
                });
                keyboardContainer.appendChild(keyRow);
            });
            
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.key-container')) {
                    closeAllPopups();
                }
            });

            return keyboardContainer;
        }

        function showVariants(mainKey, container) {
            closeAllPopups();

            const variants = longPressData[mainKey];
            const popup = document.createElement('div');
            popup.className = 'long-press-popup show';
            
            variants.forEach(char => {
                const vKey = document.createElement('div');
                vKey.className = 'variant-key';
                vKey.textContent = char;
                
                vKey.onclick = (e) => {
                    e.stopPropagation();
                    handleKeyInput(char);
                    closeAllPopups();
                };
                
                popup.appendChild(vKey);
            });
            
            container.appendChild(popup);
        }

        function closeAllPopups() {
            document.querySelectorAll('.long-press-popup').forEach(p => p.remove());
        }

        function handleKeyInput(char) {
            playSound('touch');
            const answerInput = document.getElementById('answer-input');
            if (!answerInput) return;

            if (char === 'Backspace') {
                answerInput.textContent = answerInput.textContent.slice(0, -1);
            } else {
                answerInput.textContent += char;
            }

            // GÃœNCELLEME: En az bir karakter varsa butonu aktif et
            const checkBtn = document.getElementById('check-scramble-btn');
            if (checkBtn) {
                checkBtn.disabled = answerInput.textContent.trim().length === 0;
            }
        }

        // --- Cevap KontrolÃ¼ ---
        function checkFillInBlankAnswer(correctAnswer) {
            const answerInput = document.getElementById('answer-input');
            const userAnswer = answerInput.textContent.trim();
            
            // KullanÄ±cÄ± cevabÄ±nÄ± normalleÅŸtir (SADECE HAREKE KALDIRILIR)
            const normalizedUserAnswer = normalizeForCheck(userAnswer); 

            let isCorrect = false;
            const correctAnswers = Array.isArray(correctAnswer) ? correctAnswer : [correctAnswer];

            // Her bir doÄŸru cevap iÃ§in kontrol yap
            for (const correct of correctAnswers) {
                // DoÄŸru cevabÄ± normalleÅŸtir (SADECE HAREKE KALDIRILIR)
                const normalizedCorrect = normalizeForCheck(correct); 
                
                // 1. Kesin (Harf farklarÄ± dahil) EÅŸleÅŸme KontrolÃ¼
                if (normalizedUserAnswer === normalizedCorrect) { 
                    isCorrect = true; break;
                }
                
                // 2. Kelime baÅŸÄ± Elif-Lam (Ø§Ù„) SadeleÅŸtirmesi (Ø§Ù„'siz giriÅŸi kabul etmek iÃ§in)
                if (normalizedCorrect.startsWith("Ø§Ù„")) {
                    // Elif-Lam'Ä± kaldÄ±rmadan Ã¶nce doÄŸru cevabÄ±n sadece harekelerden arÄ±ndÄ±rÄ±lmÄ±ÅŸ halini kullanÄ±rÄ±z.
                    const answerWithoutAl = normalizedCorrect.substring(2); 
                    if (normalizedUserAnswer === answerWithoutAl) { 
                        isCorrect = true; break;
                    }
                }
            }

            showFeedback(isCorrect, correctAnswer); 

            if (isCorrect) scoreCorrect++;
            else scoreIncorrect++;
        }

        // --- Cevap KontrolÃ¼ ---
// ... (checkFillInBlankAnswer fonksiyonu deÄŸiÅŸmedi)

        function showFeedback(isCorrect, correctAnswer) {
            feedbackOverlay.classList.add('show');
            if (isCorrect) {
                feedbackIcon.textContent = 'âœ”';
                feedbackIcon.className = 'correct';
                playSound('correct');
                feedbackDetails.style.display = 'none'; 
                setTimeout(nextActivity, 1200); 
            } else {
                feedbackIcon.textContent = 'âŒ';
                feedbackIcon.className = 'incorrect';
                playSound('incorrect');
                
                // ğŸ”¥ YAMA BAÅLANGICI: Geri bildirimde gizlenecek basitleÅŸtirilmiÅŸ kelimeler
                // Bu kelimeler, asÄ±l hemzeli/elifli formlarÄ± kabul etmek iÃ§in eklenmiÅŸ
                // klavye dostu, basitleÅŸtirilmiÅŸ versiyonlardÄ±r ve geri bildirimde gÃ¶sterilmeyecektir.
                const variantsToExclude = ["Ø§Ù„Ù‚Ø±Ø§Ù†","Ø§ÙØ´Ù’Ø±ÙØ¨Ù","Ø§ÙØ­ÙØ¨Ù‘Ù","Ø§ÙƒÙ„", "Ø§ÙƒØªØ¨", " Ø§ÙØ­Ù’Ù…ÙØ±", "Ø¹ÙØ´ÙØ±", " Ø§ÙØ²Ù’Ø±ÙÙ‚","Ø§ÙØ°ÙˆÙ‚Ù","Ø§ÙØµÙ’Ø¯ÙÙ‚Ø§Ø¦ÙŠ"];
                
                // Cevap listesini filtrele: Sadece ana (canonical) kelimeleri bÄ±rakÄ±r.
                const canonicalAnswers = Array.isArray(correctAnswer) 
                    ? correctAnswer.filter(answer => !variantsToExclude.includes(answer))
                    : [correctAnswer];

                // Geri bildirimde gÃ¶sterilecek cevabÄ± hazÄ±rla (Ana kelimeleri birleÅŸtir)
                const answerToShow = canonicalAnswers.join(' / ');
                // ğŸ”¥ YAMA SONU
                
                feedbackCorrectAnswer.textContent = `Ø§Ù„Ø¬ÙÙˆØ§Ø¨ Ø§Ù„ØµÙÙ‘Ø­ÙŠØ­: ${answerToShow}`;
                feedbackDetails.style.display = 'flex'; 
                feedbackOkButton.onclick = () => nextActivity(); 
            }
        }

        // --- Oyun AkÄ±ÅŸÄ± ---
        function nextActivity() {
            feedbackOverlay.classList.remove('show');
            feedbackDetails.style.display = 'none'; 
            currentActivityIndex++; 

            if (currentActivityIndex === grandTotalActivities) {
                if (currentRound === totalRounds) showFinishScreen();
                else showRoundCompleteScreen();
            } else {
                loadActivity();
            }
        }

        function showFinishScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen">
                    <p>Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª! Ù„ÙÙ‚ÙØ¯ Ø£ÙÙƒÙ’Ù…ÙÙ„Ù’ØªÙ Ø¬ÙÙ…ÙŠØ¹ Ø§Ù„Ø£ÙÙ†Ù’Ø´ÙØ·ÙØ©â€«.â€¬</p>
                    <p style="font-size: 2.5rem; color: #555; margin-bottom: 0;">Ø§Ù„Ù†Ù‘ÙØªÙŠØ¬ÙØ© Ø§Ù„Ù†Ù‘ÙÙ‡Ø§Ø¦ÙÙŠÙ‘ÙØ©:</p>
                    <div class="score-display">
                        <span class="score-item score-correct">âœ” ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">âŒ ${scoreIncorrect}</span>
                    </div>
                    <button id="replay-button" onclick="restartGame()">ğŸ”„</button>
                </div>
            `;
            instructionText.textContent = ""; 
            progressDisplay.textContent = "";
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }

        function showRoundCompleteScreen() {
            activityArea.innerHTML = `
                <div id="finish-screen" style="justify-content: center;">
                    <p>Ø£ÙØ­Ù’Ø³ÙÙ†Ù’Øª!</p>
                    <p style="font-size: 2.5rem; color: #555; margin-bottom: 0;">Ù†ÙØªÙŠØ¬ÙØ© Ù‡ÙØ°ÙÙ‡ Ø§Ù„Ø¬ÙÙˆÙ’Ù„ÙØ©</p>
                    <div class="score-display">
                        <span class="score-item score-correct">âœ” ${scoreCorrect}</span>
                        <span class="score-item score-incorrect">âŒ ${scoreIncorrect}</span>
                    </div>
                    <button id="check-scramble-btn" onclick="startNextRound()" style="font-size: 1.8rem; margin-top: 20px;">
                        Ø§Ù„ØªÙ‘Ø§Ù„ÙŠ
                    </button>
                </div>
            `;
            instructionText.textContent = ""; 
            progressDisplay.textContent = ""; 
            progressBar.style.width = '100%';
            progressBar.style.backgroundColor = 'var(--success-color)';
        }

        function startNextRound() {
            playSound('touch');
            scoreCorrect = 0;
            scoreIncorrect = 0;
            currentRound++;
            currentActivityIndex = 0;
            
            const roundStartIndex = (currentRound - 1) * questionsPerRound;
            const roundEndIndex = Math.min(currentRound * questionsPerRound, totalQuestionsInGame);
            activityQueue = allActivitiesData.slice(roundStartIndex, roundEndIndex);
            grandTotalActivities = activityQueue.length;
            
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            loadActivity(); 
        }

        function restartGame() {
            playSound('touch');
            scoreCorrect = 0;
            scoreIncorrect = 0;
            progressBar.style.width = '0%';
            progressBar.style.backgroundColor = 'var(--accent-color)';
            allActivitiesData = shuffle([...activitiesData]);
            totalQuestionsInGame = allActivitiesData.length;
            totalRounds = Math.ceil(totalQuestionsInGame / questionsPerRound);
            currentRound = 0; 
            startNextRound(); 
        }

        function updateProgress() {
            if (grandTotalActivities === 0) {
                 progressDisplay.textContent = `0 / ${grandTotalActivities}`;
                 return;
            }
            const currentTotal = currentActivityIndex + 1;
            const percentage = (currentActivityIndex / grandTotalActivities) * 100;
            progressDisplay.textContent = `${currentTotal} / ${grandTotalActivities}`;
            progressBar.style.width = `${percentage}%`;
        }
        
        // ğŸ”¥ YENÄ° BAÅLANGIÃ‡ FONKSÄ°YONU
        function startGame() {
    // 1. Dokunma sesini Ã§al
    playSound('touch');

    // 2. BaÅŸlangÄ±Ã§ ekranÄ±nÄ± kapat
    const startScreen = document.getElementById('start-screen');
    startScreen.style.display = 'none';

    // 3. Ana konteynÄ±rÄ± GÃ–RÃœNÃœR yap (HTML'de display:none vermiÅŸtik, ÅŸimdi aÃ§Ä±yoruz)
    const container = document.querySelector('.activity-container');
    if (container) {
        container.style.display = 'flex'; // Gizli olan kutuyu geri getir
    }

    // 4. CSS animasyonlarÄ± iÃ§in gerekli sÄ±nÄ±fÄ± ekle
    document.body.classList.add('game-started');
    
    // 5. Tam ekranÄ± etkinleÅŸtir
    toggleFullScreen(); 
    
    // 6. Oyun mantÄ±ÄŸÄ±nÄ± baÅŸlat
    allActivitiesData = shuffle([...activitiesData]);
    totalQuestionsInGame = allActivitiesData.length;
    totalRounds = Math.ceil(totalQuestionsInGame / questionsPerRound);
    currentRound = 0; 
    startNextRound(); 

    // 7. ğŸ”¥ YAMA: 0.6 Saniye (600ms) Gecikmeli Ses Ã‡alma
    setTimeout(() => {
        const audio = new Audio('yonergebosluk.wav');
        audio.play().catch(err => {
            console.log("Ses Ã§alma hatasÄ± (Dosya adÄ±nÄ± ve yolunu kontrol edin):", err);
        });
    }, 600); 
}

        document.addEventListener('DOMContentLoaded', () => {
            // BaÅŸlangÄ±Ã§ dÃ¼ÄŸmesine tÄ±klama olayÄ±nÄ± ekle
            if (startButton) startButton.addEventListener('click', startGame);

            // BaÅŸlangÄ±Ã§ta tam ekran durumunu kontrol et (baÅŸlatma dÃ¼ÄŸmesine raÄŸmen)
            checkFullScreen();
        });

    </script>
</body>
</html>